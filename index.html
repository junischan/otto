<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Catálogo de repuestos automotrices Otto Repuestos, encuentra frenos, aceites, llantas y más.">
  <meta name="keywords" content="repuestos, automotriz, Otto Repuestos, frenos, llantas, aceites">
  <title>Otto Repuestos</title>
  <style>
    :root {
      --primary-bg: #0b0f19;
      --card-bg: #141a2a;
      --text-color: #e6e8ee;
      --accent-color: #25d366;
      --border-color: #2a3441;
      --shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      --font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif;
    }

    body {
      margin: 0;
      background: var(--primary-bg);
      color: var(--text-color);
      font-family: var(--font-family);
    }

    /* Soporte para modo claro */
    @media (prefers-color-scheme: light) {
      :root {
        --primary-bg: #f5f5f5;
        --card-bg: #ffffff;
        --text-color: #333;
        --border-color: #ccc;
      }
    }

    /* Header con buscador */
    .header {
      padding: 20px;
      background: var(--card-bg);
      box-shadow: var(--shadow);
    }

    h1 {
      text-align: center;
      font-size: 2em;
      margin: 0 0 20px 0;
    }

    .search-container {
      max-width: 500px;
      margin: 0 auto;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 12px 50px 12px 20px;
      border: 2px solid var(--border-color);
      border-radius: 25px;
      background: var(--primary-bg);
      color: var(--text-color);
      font-size: 16px;
      box-sizing: border-box;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    .search-clear {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #a7b0c3;
      cursor: pointer;
      font-size: 18px;
      display: none;
    }

    .search-clear:hover {
      color: var(--text-color);
    }

    /* Filtros y estadísticas */
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .filter-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 8px 16px;
      border: 1px solid var(--border-color);
      border-radius: 20px;
      background: var(--card-bg);
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.3s;
      font-size: 12px;
    }

    .filter-btn:hover,
    .filter-btn.active {
      background: var(--accent-color);
      border-color: var(--accent-color);
      color: #000;
    }

    .stats {
      font-size: 12px;
      color: #a7b0c3;
    }

    .grid {
      column-count: 2;
      column-gap: 15px;
      padding: 15px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: var(--shadow);
      overflow: hidden;
      margin-bottom: 15px;
      display: inline-block;
      width: 100%;
      break-inside: avoid;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(0, 0, 0, .4);
    }

    .card.hidden {
      display: none;
    }

    .card img {
      width: 100%;
      height: auto;
      object-fit: cover;
      display: block;
      background: #0f1529;
    }

    .info {
      padding: 10px;
      font-size: 13px;
    }

    .info .codigo {
      font-weight: 700;
      font-size: 14px;
    }

    .info .desc {
      color: #a7b0c3;
      font-size: 11px;
      margin-top: 5px;
      margin-bottom: 10px;
    }

    .info .precio {
      font-weight: 700;
      color: var(--accent-color);
      font-size: 15px;
    }

    /* Botones de acción en cada card */
    .card-actions {
      padding: 0 10px 10px;
      display: flex;
      gap: 8px;
    }

    .btn {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .btn-whatsapp {
      background: var(--accent-color);
      color: #000;
    }

    .btn-whatsapp:hover {
      background: #1ea952;
    }

    .btn-share {
      background: var(--border-color);
      color: var(--text-color);
    }

    .btn-share:hover {
      background: #3a4551;
    }

    /* Carrito flotante */
    .cart-float {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--accent-color);
      color: #000;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
      z-index: 999;
      font-size: 24px;
      transition: all 0.3s;
    }

    .cart-float:hover {
      transform: scale(1.1);
    }

    .cart-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff4444;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 50px;
      font-size: 16px;
      color: #a7b0c3;
    }

    .no-results {
      text-align: center;
      padding: 50px;
      color: #a7b0c3;
    }

    @media (min-width: 600px) {
      .grid {
        column-count: 3;
      }
    }
    @media (min-width: 900px) {
      .grid {
        column-count: 4;
      }
    }

    @media (max-width: 600px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .filter-buttons {
        justify-content: center;
      }
    }

    /* Estilos para el Lightbox mejorado */
    .lightbox {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .lightbox.active {
      visibility: visible;
      opacity: 1;
    }

    .lightbox-content {
      position: relative;
      max-width: 90%;
      max-height: 90%;
    }

    .lightbox img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      background: transparent;
    }

    .lightbox-close {
      position: absolute;
      top: -40px;
      right: 0;
      background: none;
      border: none;
      color: #fff;
      font-size: 30px;
      cursor: pointer;
      z-index: 1001;
    }

    .lightbox-info {
      position: absolute;
      bottom: -80px;
      left: 0;
      right: 0;
      background: rgba(20, 26, 42, 0.9);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    /* Modal para carrito */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 10px;
      max-width: 500px;
      width: 90%;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 20px;
      cursor: pointer;
    }

    .modal-total {
      margin-top: 20px;
      font-weight: bold;
    }

    .cart-item {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
    }

    .cart-item img {
      width: 50px;
      height: auto;
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>Catálogo Otto Repuestos</h1>
    <div class="search-container">
      <input type="text" id="searchInput" class="search-input" placeholder="Buscar por código o descripción..." aria-label="Buscar productos">
      <button id="searchClear" class="search-clear" aria-label="Limpiar búsqueda">✕</button>
    </div>
  </header>

  <main>
    <div class="controls">
      <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all" aria-pressed="true">Todos</button>
        <button class="filter-btn" data-filter="price-low" aria-pressed="false">Precio Bajo</button>
        <button class="filter-btn" data-filter="price-high" aria-pressed="false">Precio Alto</button>
        <button class="filter-btn" data-filter="recent" aria-pressed="false">Recientes</button>
      </div>
      <div class="stats">
        <span id="itemCount">0</span> productos encontrados
      </div>
    </div>

    <div id="loading" class="loading">Cargando productos...</div>
    <section class="grid" id="grid" role="region" aria-live="polite"></section>
    <div id="noResults" class="no-results" style="display: none;">
      No se encontraron productos que coincidan con tu búsqueda
    </div>
  </main>

  <!-- Carrito flotante -->
  <div class="cart-float" id="cartFloat" role="button" aria-label="Ver carrito">
    🛒
    <span class="cart-count" id="cartCount">0</span>
  </div>

  <!-- Lightbox mejorado -->
  <div id="lightbox" class="lightbox" role="dialog" aria-label="Vista ampliada del producto" tabindex="-1">
    <div class="lightbox-content">
      <button class="lightbox-close" aria-label="Cerrar vista ampliada">&times;</button>
      <img src="" alt="Imagen ampliada del producto">
      <div class="lightbox-info">
        <div class="codigo"></div>
        <div class="desc"></div>
        <div class="precio"></div>
      </div>
    </div>
  </div>

  <!-- Modal para carrito -->
  <div id="cartModal" class="modal" role="dialog" aria-label="Vista del carrito">
    <div class="modal-content">
      <button class="modal-close" aria-label="Cerrar carrito">&times;</button>
      <h2>Tu Carrito</h2>
      <div id="cartItems"></div>
      <div class="modal-total">Total: <span id="cartTotal">0 Gs</span></div>
      <button class="btn btn-whatsapp" id="sendCart">Enviar Pedido</button>
    </div>
  </div>

  <script>
    // Variables globales
    const elements = {
      grid: document.getElementById("grid"),
      lightbox: document.getElementById("lightbox"),
      lightboxImage: document.querySelector("#lightbox img"),
      lightboxInfo: document.querySelector(".lightbox-info"),
      searchInput: document.getElementById("searchInput"),
      searchClear: document.getElementById("searchClear"),
      itemCount: document.getElementById("itemCount"),
      loading: document.getElementById("loading"),
      noResults: document.getElementById("noResults"),
      cartFloat: document.getElementById("cartFloat"),
      cartCount: document.getElementById("cartCount"),
      cartModal: document.getElementById("cartModal"),
      cartItems: document.getElementById("cartItems"),
      cartTotal: document.getElementById("cartTotal"),
      sendCart: document.getElementById("sendCart")
    };

    let ITEMS = [];
    let filteredItems = [];
    let cart = JSON.parse(localStorage.getItem('ottocart') || '[]');

    // Función para formatear precios
    const formatPrice = (n) => new Intl.NumberFormat('es-PY').format(n) + " Gs";

    // Debounce para búsqueda
    const debounce = (func, wait) => {
      let timeout;
      return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    };

    // Actualizar contador del carrito
    function updateCartCount() {
      elements.cartCount.textContent = cart.length;
      elements.cartCount.style.display = cart.length > 0 ? 'flex' : 'none';
    }

    // Cargar datos con cache
    async function loadData() {
      const cachedData = localStorage.getItem('ottoData');
      if (cachedData) {
        ITEMS = JSON.parse(cachedData);
        initializeCatalog();
        return;
      }

      try {
        const response = await fetch('data.json');
        if (!response.ok) throw new Error('No se pudo cargar data.json');
        ITEMS = await response.json();
        localStorage.setItem('ottoData', JSON.stringify(ITEMS));
      } catch (error) {
        console.warn('Cargando datos de ejemplo:', error.message);
        ITEMS = [
          {
            codigo: "FR001",
            descripcion: "Freno de disco delantero Toyota Corolla 2015-2020",
            precio: 450000,
            imagen: "https://via.placeholder.com/300x200/333/fff?text=Freno+Disco"
          },
          {
            codigo: "MT002",
            descripcion: "Motor de arranque Nissan Sentra 1.8L",
            precio: 320000,
            imagen: "https://via.placeholder.com/300x200/333/fff?text=Motor+Arranque"
          },
          {
            codigo: "AC003",
            descripcion: "Aceite motor sintético 5W-30 4L",
            precio: 180000,
            imagen: "https://via.placeholder.com/300x200/333/fff?text=Aceite+Motor"
          },
          {
            codigo: "FL004",
            descripcion: "Filtro de aire Honda Civic 2016-2021",
            precio: 85000,
            imagen: "https://via.placeholder.com/300x200/333/fff?text=Filtro+Aire"
          },
          {
            codigo: "BA005",
            descripcion: "Batería 12V 60Ah libre mantenimiento",
            precio: 280000,
            imagen: "https://via.placeholder.com/300x200/333/fff?text=Bateria+12V"
          },
          {
            codigo: "LL006",
            descripcion: "Llantas 195/65R15 Michelin Energy Saver",
            precio: 350000,
            imagen: "https://via.placeholder.com/300x200/333/fff?text=Llantas+195"
          }
        ];
      }
      initializeCatalog();
    }

    // Inicializar catálogo
    function initializeCatalog() {
      elements.loading.style.display = 'none';
      filteredItems = [...ITEMS];
      renderItems();
      updateCartCount();
    }

    // Renderizar productos
    function renderItems() {
      if (filteredItems.length === 0) {
        elements.grid.style.display = 'none';
        elements.noResults.style.display = 'block';
        elements.itemCount.textContent = '0';
        return;
      }

      elements.grid.style.display = 'block';
      elements.noResults.style.display = 'none';
      elements.itemCount.textContent = filteredItems.length;

      elements.grid.innerHTML = filteredItems.map(p => `
        <article class="card" data-fullimage="${p.imagen}" data-codigo="${p.codigo}" data-desc="${p.descripcion}" data-precio="${p.precio}">
          <img src="${p.imagen}" alt="${p.descripcion}" loading="lazy" onerror="this.src='https://via.placeholder.com/300x200/333/fff?text=Sin+Imagen'">
          <div class="info">
            <div class="codigo">${p.codigo}</div>
            <div class="desc">${p.descripcion}</div>
            <div class="precio">${formatPrice(p.precio)}</div>
          </div>
          <div class="card-actions">
            <button class="btn btn-whatsapp" onclick="sendWhatsApp('${p.codigo}', '${p.descripcion}', ${p.precio})" aria-label="Contactar por WhatsApp para ${p.codigo}">
              💬 WhatsApp
            </button>
            <button class="btn btn-share" onclick="shareProduct('${p.codigo}', '${p.descripcion}')" aria-label="Compartir ${p.codigo}">
              📤 Compartir
            </button>
          </div>
        </article>
      `).join('');

      // Agregar event listeners para el lightbox
      const cards = document.querySelectorAll(".card");
      cards.forEach(card => {
        const img = card.querySelector('img');
        img.addEventListener("click", (e) => {
          e.stopPropagation();
          openLightbox(card);
        });

        // Agregar al carrito al hacer doble clic
        card.addEventListener("dblclick", () => {
          addToCart(card.dataset);
        });
      });
    }

    // Abrir lightbox con información
    function openLightbox(card) {
      const fullImageUrl = card.getAttribute("data-fullimage");
      const codigo = card.getAttribute("data-codigo");
      const desc = card.getAttribute("data-desc");
      const precio = card.getAttribute("data-precio");

      elements.lightboxImage.src = fullImageUrl;
      elements.lightboxImage.alt = `Imagen ampliada de ${desc}`;
      elements.lightboxInfo.querySelector('.codigo').textContent = codigo;
      elements.lightboxInfo.querySelector('.desc').textContent = desc;
      elements.lightboxInfo.querySelector('.precio').textContent = formatPrice(parseInt(precio));

      elements.lightbox.classList.add("active");
      elements.lightbox.focus(); // Foco para accesibilidad
    }

    // Cerrar lightbox
    function closeLightbox() {
      elements.lightbox.classList.remove("active");
    }

    // Búsqueda en tiempo real con debounce
    elements.searchInput.addEventListener('input', debounce((e) => {
      const query = e.target.value.toLowerCase().trim();

      if (query) {
        elements.searchClear.style.display = 'block';
        filteredItems = ITEMS.filter(item =>
          item.codigo.toLowerCase().includes(query) ||
          item.descripcion.toLowerCase().includes(query)
        );
      } else {
        elements.searchClear.style.display = 'none';
        filteredItems = [...ITEMS];
      }

      renderItems();
    }, 300));

    // Limpiar búsqueda
    elements.searchClear.addEventListener('click', () => {
      elements.searchInput.value = '';
      elements.searchClear.style.display = 'none';
      filteredItems = [...ITEMS];
      renderItems();
    });

    // Filtros
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.filter-btn').forEach(b => {
          b.classList.remove('active');
          b.setAttribute('aria-pressed', 'false');
        });
        e.target.classList.add('active');
        e.target.setAttribute('aria-pressed', 'true');

        const filter = e.target.dataset.filter;
        let sortedItems = [...filteredItems];

        switch(filter) {
          case 'price-low':
            sortedItems.sort((a, b) => a.precio - b.precio);
            break;
          case 'price-high':
            sortedItems.sort((a, b) => b.precio - a.precio);
            break;
          case 'recent':
            sortedItems.reverse();
            break;
          default:
            // 'all' - mantener orden original
            break;
        }

        filteredItems = sortedItems;
        renderItems();
      });
    });

    // Enviar por WhatsApp
    function sendWhatsApp(codigo, descripcion, precio) {
      const mensaje = `¡Hola! Me interesa este repuesto:\n\n` +
                     `📋 Código: ${codigo}\n` +
                     `📝 Descripción: ${descripcion}\n` +
                     `💰 Precio: ${formatPrice(precio)}\n\n` +
                     `¿Está disponible?`;

      const url = `https://wa.me/595981000000?text=${encodeURIComponent(mensaje)}`;
      window.open(url, '_blank');
    }

    // Compartir producto
    function shareProduct(codigo, descripcion) {
      if (navigator.share) {
        navigator.share({
          title: `Otto Repuestos - ${codigo}`,
          text: descripcion,
          url: window.location.href
        });
      } else {
        // Fallback: copiar al portapapeles
        const text = `${codigo} - ${descripcion}\n${window.location.href}`;
        navigator.clipboard.writeText(text).then(() => {
          alert('Información copiada al portapapeles');
        });
      }
    }

    // Agre