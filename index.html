<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Otto Repuestos</title>
<style>
  body {
    margin: 0;
    background: #0b0f19;
    color: #e6e8ee;
    font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif;
  }
  
  /* Header con buscador */
  .header {
    padding: 20px;
    background: #141a2a;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }
  
  h1 {
    text-align: center;
    font-size: 2em;
    margin: 0 0 20px 0;
  }
  
  .search-container {
    max-width: 500px;
    margin: 0 auto;
    position: relative;
  }
  
  .search-input {
    width: 100%;
    padding: 12px 50px 12px 20px;
    border: 2px solid #2a3441;
    border-radius: 25px;
    background: #0b0f19;
    color: #e6e8ee;
    font-size: 16px;
    box-sizing: border-box;
  }
  
  .search-input:focus {
    outline: none;
    border-color: #25d366;
  }
  
  .search-clear {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #a7b0c3;
    cursor: pointer;
    font-size: 18px;
    display: none;
  }
  
  .search-clear:hover {
    color: #e6e8ee;
  }
  
  /* Filtros y estad√≠sticas */
  .controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    flex-wrap: wrap;
    gap: 10px;
  }
  
  .filter-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  
  .filter-btn {
    padding: 8px 16px;
    border: 1px solid #2a3441;
    border-radius: 20px;
    background: #141a2a;
    color: #e6e8ee;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 12px;
  }
  
  .filter-btn:hover,
  .filter-btn.active {
    background: #25d366;
    border-color: #25d366;
    color: #000;
  }
  
  .stats {
    font-size: 12px;
    color: #a7b0c3;
  }
  
  .grid {
    column-count: 2;
    column-gap: 15px;
    padding: 15px;
  }
  
  .card {
    background: #141a2a;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, .3);
    overflow: hidden;
    margin-bottom: 15px;
    display: inline-block;
    width: 100%;
    break-inside: avoid;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    position: relative;
  }
  
  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(0, 0, 0, .4);
  }
  
  .card.hidden {
    display: none;
  }
  
  .card img {
    width: 100%;
    height: auto;
    object-fit: cover;
    display: block;
    background: #0f1529;
  }
  
  .info {
    padding: 10px;
    font-size: 13px;
  }
  
  .info .codigo {
    font-weight: 700;
    font-size: 14px;
  }
  
  .info .desc {
    color: #a7b0c3;
    font-size: 11px;
    margin-top: 5px;
    margin-bottom: 10px;
  }
  
  .info .precio {
    font-weight: 700;
    color: #25d366;
    font-size: 15px;
  }
  
  /* Botones de acci√≥n en cada card */
  .card-actions {
    padding: 0 10px 10px;
    display: flex;
    gap: 8px;
  }
  
  .btn {
    flex: 1;
    padding: 8px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 11px;
    font-weight: 600;
    transition: all 0.2s;
  }
  
  .btn-whatsapp {
    background: #25d366;
    color: #000;
  }
  
  .btn-whatsapp:hover {
    background: #1ea952;
  }
  
  .btn-share {
    background: #2a3441;
    color: #e6e8ee;
  }
  
  .btn-share:hover {
    background: #3a4551;
  }
  
  /* Carrito flotante */
  .cart-float {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #25d366;
    color: #000;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
    z-index: 999;
    font-size: 24px;
    transition: all 0.3s;
  }
  
  .cart-float:hover {
    transform: scale(1.1);
  }
  
  .cart-count {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ff4444;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
  }
  
  /* Loading */
  .loading {
    text-align: center;
    padding: 50px;
    font-size: 16px;
    color: #a7b0c3;
  }
  
  .no-results {
    text-align: center;
    padding: 50px;
    color: #a7b0c3;
  }
  
  @media (min-width: 600px) {
    .grid {
      column-count: 3;
    }
  }
  @media (min-width: 900px) {
    .grid {
      column-count: 4;
    }
  }
  
  @media (max-width: 600px) {
    .controls {
      flex-direction: column;
      align-items: stretch;
    }
    
    .filter-buttons {
      justify-content: center;
    }
  }

  /* Estilos para el Lightbox mejorado */
  .lightbox {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.3s, visibility 0.3s;
  }
  
  .lightbox.active {
    visibility: visible;
    opacity: 1;
  }
  
  .lightbox-content {
    position: relative;
    max-width: 90%;
    max-height: 90%;
  }
  
  .lightbox img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    background: transparent;
  }
  
  .lightbox-close {
    position: absolute;
    top: -40px;
    right: 0;
    background: none;
    border: none;
    color: #fff;
    font-size: 30px;
    cursor: pointer;
    z-index: 1001;
  }
  
  .lightbox-info {
    position: absolute;
    bottom: -80px;
    left: 0;
    right: 0;
    background: rgba(20, 26, 42, 0.9);
    padding: 15px;
    border-radius: 8px;
    text-align: center;
  }
</style>
</head>
<body>
  <div class="header">
    <h1>Cat√°logo Otto Repuestos</h1>
    <div class="search-container">
      <input type="text" id="searchInput" class="search-input" placeholder="Buscar por c√≥digo o descripci√≥n...">
      <button id="searchClear" class="search-clear">‚úï</button>
    </div>
  </div>
  
  <div class="controls">
    <div class="filter-buttons">
      <button class="filter-btn active" data-filter="all">Todos</button>
      <button class="filter-btn" data-filter="price-low">Precio Bajo</button>
      <button class="filter-btn" data-filter="price-high">Precio Alto</button>
      <button class="filter-btn" data-filter="recent">Recientes</button>
    </div>
    <div class="stats">
      <span id="itemCount">0</span> productos encontrados
    </div>
  </div>

  <div id="loading" class="loading">Cargando productos...</div>
  <div class="grid" id="grid"></div>
  <div id="noResults" class="no-results" style="display: none;">
    No se encontraron productos que coincidan con tu b√∫squeda
  </div>

  <!-- Carrito flotante -->
  <div class="cart-float" id="cartFloat">
    üõí
    <span class="cart-count" id="cartCount">0</span>
  </div>

  <!-- Lightbox mejorado -->
  <div id="lightbox" class="lightbox">
    <div class="lightbox-content">
      <button class="lightbox-close">&times;</button>
      <img src="" alt="Imagen ampliada">
      <div class="lightbox-info">
        <div class="codigo"></div>
        <div class="desc"></div>
        <div class="precio"></div>
      </div>
    </div>
  </div>

<script>
const money = n => new Intl.NumberFormat('es-PY').format(n) + " Gs";
const gridElement = document.getElementById("grid");
const lightbox = document.getElementById("lightbox");
const lightboxImage = lightbox.querySelector("img");
const lightboxInfo = lightbox.querySelector(".lightbox-info");
const searchInput = document.getElementById("searchInput");
const searchClear = document.getElementById("searchClear");
const itemCount = document.getElementById("itemCount");
const loading = document.getElementById("loading");
const noResults = document.getElementById("noResults");
const cartFloat = document.getElementById("cartFloat");
const cartCount = document.getElementById("cartCount");

let ITEMS = [];
let filteredItems = [];
let cart = JSON.parse(localStorage.getItem('ottocart') || '[]');

// Actualizar contador del carrito
function updateCartCount() {
  cartCount.textContent = cart.length;
  cartCount.style.display = cart.length > 0 ? 'flex' : 'none';
}

// Datos de ejemplo (reemplaza con tu data.json)
const sampleData = [
  {
    codigo: "FR001",
    descripcion: "Freno de disco delantero Toyota Corolla 2015-2020",
    precio: 450000,
    imagen: "https://via.placeholder.com/300x200/333/fff?text=Freno+Disco"
  },
  {
    codigo: "MT002", 
    descripcion: "Motor de arranque Nissan Sentra 1.8L",
    precio: 320000,
    imagen: "https://via.placeholder.com/300x200/333/fff?text=Motor+Arranque"
  },
  {
    codigo: "AC003",
    descripcion: "Aceite motor sint√©tico 5W-30 4L",
    precio: 180000,
    imagen: "https://via.placeholder.com/300x200/333/fff?text=Aceite+Motor"
  },
  {
    codigo: "FL004",
    descripcion: "Filtro de aire Honda Civic 2016-2021",
    precio: 85000,
    imagen: "https://via.placeholder.com/300x200/333/fff?text=Filtro+Aire"
  },
  {
    codigo: "BA005",
    descripcion: "Bater√≠a 12V 60Ah libre mantenimiento",
    precio: 280000,
    imagen: "https://via.placeholder.com/300x200/333/fff?text=Bateria+12V"
  },
  {
    codigo: "LL006",
    descripcion: "Llantas 195/65R15 Michelin Energy Saver",
    precio: 350000,
    imagen: "https://via.placeholder.com/300x200/333/fff?text=Llantas+195"
  }
];

// Cargar datos
function loadData() {
  // Intenta cargar desde data.json, si no existe usa datos de ejemplo
  fetch('data.json')
    .then(response => {
      if (!response.ok) {
        throw new Error('Usando datos de ejemplo');
      }
      return response.json();
    })
    .then(data => {
      ITEMS = data;
      initializeCatalog();
    })
    .catch(error => {
      console.log('Cargando datos de ejemplo...');
      ITEMS = sampleData;
      initializeCatalog();
    });
}

// Inicializar cat√°logo
function initializeCatalog() {
  loading.style.display = 'none';
  filteredItems = [...ITEMS];
  renderItems();
  updateCartCount();
}

// Renderizar productos
function renderItems() {
  if (filteredItems.length === 0) {
    gridElement.style.display = 'none';
    noResults.style.display = 'block';
    itemCount.textContent = '0';
    return;
  }
  
  gridElement.style.display = 'block';
  noResults.style.display = 'none';
  itemCount.textContent = filteredItems.length;
  
  gridElement.innerHTML = filteredItems.map(p => `
    <div class="card" data-fullimage="${p.imagen}" data-codigo="${p.codigo}" data-desc="${p.descripcion}" data-precio="${p.precio}">
      <img src="${p.imagen}" alt="${p.descripcion}" onerror="this.src='https://via.placeholder.com/300x200/333/fff?text=Sin+Imagen'">
      <div class="info">
        <div class="codigo">${p.codigo}</div>
        <div class="desc">${p.descripcion}</div>
        <div class="precio">${money(p.precio)}</div>
      </div>
      <div class="card-actions">
        <button class="btn btn-whatsapp" onclick="sendWhatsApp('${p.codigo}', '${p.descripcion}', ${p.precio})">
          üí¨ WhatsApp
        </button>
        <button class="btn btn-share" onclick="shareProduct('${p.codigo}', '${p.descripcion}')">
          üì§ Compartir
        </button>
      </div>
    </div>
  `).join('');

  // Agregar event listeners para el lightbox
  const cards = document.querySelectorAll(".card");
  cards.forEach(card => {
    const img = card.querySelector('img');
    img.addEventListener("click", (e) => {
      e.stopPropagation();
      openLightbox(card);
    });
    
    // Agregar al carrito al hacer doble clic
    card.addEventListener("dblclick", () => {
      addToCart(card.dataset);
    });
  });
}

// Abrir lightbox con informaci√≥n
function openLightbox(card) {
  const fullImageUrl = card.getAttribute("data-fullimage");
  const codigo = card.getAttribute("data-codigo");
  const desc = card.getAttribute("data-desc");
  const precio = card.getAttribute("data-precio");
  
  lightboxImage.src = fullImageUrl;
  lightboxInfo.querySelector('.codigo').textContent = codigo;
  lightboxInfo.querySelector('.desc').textContent = desc;
  lightboxInfo.querySelector('.precio').textContent = money(parseInt(precio));
  
  lightbox.classList.add("active");
}

// Cerrar lightbox
function closeLightbox() {
  lightbox.classList.remove("active");
}

// B√∫squeda en tiempo real
searchInput.addEventListener('input', (e) => {
  const query = e.target.value.toLowerCase().trim();
  
  if (query) {
    searchClear.style.display = 'block';
    filteredItems = ITEMS.filter(item => 
      item.codigo.toLowerCase().includes(query) || 
      item.descripcion.toLowerCase().includes(query)
    );
  } else {
    searchClear.style.display = 'none';
    filteredItems = [...ITEMS];
  }
  
  renderItems();
});

// Limpiar b√∫squeda
searchClear.addEventListener('click', () => {
  searchInput.value = '';
  searchClear.style.display = 'none';
  filteredItems = [...ITEMS];
  renderItems();
});

// Filtros
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    
    const filter = e.target.dataset.filter;
    let sortedItems = [...filteredItems];
    
    switch(filter) {
      case 'price-low':
        sortedItems.sort((a, b) => a.precio - b.precio);
        break;
      case 'price-high':
        sortedItems.sort((a, b) => b.precio - a.precio);
        break;
      case 'recent':
        sortedItems.reverse();
        break;
      default:
        // 'all' - mantener orden original
        break;
    }
    
    filteredItems = sortedItems;
    renderItems();
  });
});

// Enviar por WhatsApp
function sendWhatsApp(codigo, descripcion, precio) {
  const mensaje = `¬°Hola! Me interesa este repuesto:\n\n` +
                 `üìã C√≥digo: ${codigo}\n` +
                 `üìù Descripci√≥n: ${descripcion}\n` +
                 `üí∞ Precio: ${money(precio)}\n\n` +
                 `¬øEst√° disponible?`;
  
  const url = `https://wa.me/595981000000?text=${encodeURIComponent(mensaje)}`;
  window.open(url, '_blank');
}

// Compartir producto
function shareProduct(codigo, descripcion) {
  if (navigator.share) {
    navigator.share({
      title: `Otto Repuestos - ${codigo}`,
      text: descripcion,
      url: window.location.href
    });
  } else {
    // Fallback: copiar al portapapeles
    const text = `${codigo} - ${descripcion}\n${window.location.href}`;
    navigator.clipboard.writeText(text).then(() => {
      alert('Informaci√≥n copiada al portapapeles');
    });
  }
}

// Agregar al carrito
function addToCart(item) {
  const exists = cart.find(cartItem => cartItem.codigo === item.codigo);
  
  if (!exists) {
    cart.push({
      codigo: item.codigo,
      descripcion: item.desc,
      precio: parseInt(item.precio),
      imagen: item.fullimage
    });
    
    localStorage.setItem('ottocart', JSON.stringify(cart));
    updateCartCount();
    
    // Feedback visual
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: #25d366;
      color: #000;
      padding: 15px;
      border-radius: 8px;
      z-index: 9999;
      font-weight: bold;
    `;
    notification.textContent = '¬°Agregado al carrito!';
    document.body.appendChild(notification);
    
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 2000);
  }
}

// Ver carrito
cartFloat.addEventListener('click', () => {
  if (cart.length === 0) {
    alert('El carrito est√° vac√≠o');
    return;
  }
  
  let cartMessage = 'üõí *TU CARRITO:*\n\n';
  let total = 0;
  
  cart.forEach((item, index) => {
    cartMessage += `${index + 1}. ${item.codigo}\n`;
    cartMessage += `   ${item.descripcion}\n`;
    cartMessage += `   ${money(item.precio)}\n\n`;
    total += item.precio;
  });
  
  cartMessage += `üí∞ *TOTAL: ${money(total)}*\n\n`;
  cartMessage += '¬øTe interesa hacer el pedido?';
  
  const url = `https://wa.me/595981000000?text=${encodeURIComponent(cartMessage)}`;
  window.open(url, '_blank');
});

// Event listeners del lightbox
lightbox.addEventListener("click", e => {
  if (e.target === lightbox) {
    closeLightbox();
  }
});

lightbox.querySelector('.lightbox-close').addEventListener('click', closeLightbox);

// Cargar datos al iniciar
loadData();

// Atajos de teclado
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeLightbox();
  }
  if (e.key === '/' && e.target.tagName !== 'INPUT') {
    e.preventDefault();
    searchInput.focus();
  }
});

</script>
</body>
</html>